## Quick context — what this repo is

- Flutter mobile/web/desktop app using Firebase Auth + Firestore (see `pubspec.yaml`).
- Firebase configuration is generated in `lib/firebase_options.dart` (FlutterFire CLI).
- Auth and user persistence live under `lib/auth/auth_service.dart` (users saved to Firestore `users` collection).

## High-level architecture (what to know immediately)

- Entry point: `lib/main.dart`.
  - `MyApp` defines named routes: `/login`, `/register`, `/home`.
  - `AuthWrapper` uses a `StreamBuilder` on `AuthService().authStateChanges` to choose between `HomeScreen` and `LoginScreen`.
- UI screens are under `lib/screens/` (notable files: `login_screen.dart`, `register_screen.dart`, `home_screen.dart`).
- Auth logic is concentrated in `lib/auth/auth_service.dart` which calls `FirebaseAuth` and `FirebaseFirestore`.

## Concrete patterns and conventions to follow

- Auth flows: callers expect `AuthService` methods to return `UserCredential?` on success or `null` on failure. Code checks for `null` (e.g., login/register flows).
- Firestore: new users are stored at `collection('users').doc(user.uid)` in `signUpAndSaveData` — keep that naming if adding code that reads or mutates user profiles.
- Navigation: use the existing named routes. Use `Navigator.pushReplacementNamed` or `pushNamedAndRemoveUntil` for auth transitions (see `login_screen.dart` and `register_screen.dart`).
- Forms: screens use `GlobalKey<FormState>`, `TextFormField` validators and `FocusNode`s to move focus on validation errors — prefer the same pattern for consistency.
- UI strings and comments are Spanish; keep new UI text in Spanish to match the codebase tone.

## Integration points and external dependencies

- Firebase: `firebase_core`, `firebase_auth`, `cloud_firestore` are primary dependencies (see `pubspec.yaml`).
- `lib/firebase_options.dart` is generated and checked in — to change Firebase projects, use FlutterFire CLI (`flutterfire configure`) rather than manual edits.

## Build / run / debug notes (commands you can run locally)

Run these from the repo root in PowerShell (Windows):

```powershell
flutter pub get
flutter run -d <device-id>    # e.g. -d windows, -d chrome, -d emulator-id
```

Quick dev checks:
- Hot reload works with `r` in `flutter run` session.
- To reconfigure Firebase (if needed): install and use FlutterFire CLI; the checked-in `lib/firebase_options.dart` was generated by it.

## Small implementation contract for new code changes

- Inputs: keep using `Map<String, dynamic>` for user metadata passed into `AuthService.signUpAndSaveData` (see `register_screen.dart`).
- Output: `UserCredential?` or `null` on error — propagate `null` to UI and show a SnackBar with a user-friendly Spanish message.
- Error handling: follow current pattern — AuthService catches `FirebaseAuthException`, prints debug info, and returns `null` (UI shows SnackBar).

## Files to inspect when changing behavior

- `lib/main.dart` — routes + auth wrapper
- `lib/auth/auth_service.dart` — all Firebase auth + Firestore user creation
- `lib/screens/login_screen.dart` & `lib/screens/register_screen.dart` — form patterns, validators, navigation
- `lib/firebase_options.dart` — Firebase config (auto-generated)

## What *not* to change without confirmation

- Do not remove or rename the `users` Firestore collection or its document structure without updating both `auth_service.dart` and any code that reads user profiles.
- Avoid manual edits of `lib/firebase_options.dart` — use FlutterFire CLI.

## If you add features

- Register new screens under `lib/screens/` and add their route in `lib/main.dart` routes map.
- Follow existing Spanish-language UX copy and `SnackBar` patterns for errors/successes.

---
If anything above is unclear or you want the file to include more examples (e.g. typical code snippets for adding a new screen or reading current user data from Firestore), tell me which area to expand and I will update this file.
